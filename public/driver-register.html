<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="wasalny">ÙˆØµÙ„Ù†ÙŠ</title>
    <link rel="stylesheet" href="/css/theme.css">
    <link rel="stylesheet" href="/css/driver-register.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800;900&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="register-container">
        <div class="register-card">
            <div class="card-header">
                <a href="/" class="back-link" data-i18n="back_to_home">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <div class="logo">
                    <span class="logo-icon">ğŸš</span>
                    <h1 class="logo-text" data-i18n="wasalny">ÙˆØµÙ„Ù†ÙŠ</h1>
                </div>
                <h2 class="card-title" data-i18n="register_new_driver">ØªØ³Ø¬ÙŠÙ„ Ø³Ø§Ø¦Ù‚ Ø¬Ø¯ÙŠØ¯</h2>
                <p class="card-subtitle" data-i18n="join_network">Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ø´Ø¨ÙƒØ© ÙˆØµÙ„Ù†ÙŠ ÙˆØ§Ø¨Ø¯Ø£ ÙÙŠ Ø®Ø¯Ù…Ø© Ø§Ù„Ø±ÙƒØ§Ø¨</p>
            </div>

            <div id="successMessage" class="success-message" style="display: none;">
                âœ… ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø·Ù„Ø¨Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹
            </div>

            <div id="errorMessage" class="error-message" style="display: none;"></div>

            <form id="driverRegistrationForm" class="registration-form">
                <div class="form-section">
                    <h3 class="section-title">ğŸ“‹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</h3>

                    <div class="form-group">
                        <label class="form-label" data-i18n="full_name">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
                        <input type="text" id="name" class="form-input" data-i18n-placeholder="name_placeholder"
                            required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>
                        <input type="tel" id="phone" class="form-input" placeholder="01234567890" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *</label>
                        <input type="password" id="password" class="form-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *</label>
                        <input type="password" id="confirmPassword" class="form-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="section-title">ğŸš— Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</h3>

                    <div class="form-group">
                        <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©</label>
                        <input type="text" id="plateNumber" class="form-input" placeholder="Ù† Ø¹ Ù… 1234">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ø®Ø· Ø§Ù„Ù…ÙØ¶Ù„</label>
                        <select id="preferredRoute" class="form-input">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø®Ø·</option>
                        </select>
                    </div>
                </div>

                <div class="form-terms">
                    <label class="checkbox-label">
                        <input type="checkbox" id="terms" required>
                        <span>Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…</span>
                    </label>
                </div>

                <button type="submit" class="btn-submit">
                    <span class="btn-text">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¢Ù†</span>
                    <span class="btn-loading" style="display: none;">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...</span>
                </button>
            </form>

            <div class="login-link">
                <p>Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ <a href="/driver">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a></p>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/api';

        // Load routes
        async function loadRoutes() {
            try {
                const response = await fetch(`${API_BASE}/routes`);
                const data = await response.json();
                if (data.success) {
                    const select = document.getElementById('preferredRoute');
                    data.routes.forEach(route => {
                        const option = document.createElement('option');
                        option.value = route.id;
                        option.textContent = route.name;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading routes:', error);
            }
        }

        // Handle form submission
        document.getElementById('driverRegistrationForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const plateNumber = document.getElementById('plateNumber').value;
            const preferredRoute = document.getElementById('preferredRoute').value;

            // Validation
            if (password !== confirmPassword) {
                showError('ÙƒÙ„Ù…ØªØ§ Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†');
                return;
            }

            if (password.length < 6) {
                showError('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }

            // Show loading
            const btnText = document.querySelector('.btn-text');
            const btnLoading = document.querySelector('.btn-loading');
            btnText.style.display = 'none';
            btnLoading.style.display = 'inline';

            try {
                // Register driver
                const response = await fetch(`${API_BASE}/driver/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, phone, password })
                });

                const data = await response.json();

                if (data.success) {
                    // If vehicle info provided, create vehicle
                    if (plateNumber) {
                        await fetch(`${API_BASE}/admin/vehicles`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                plate_number: plateNumber,
                                driver_id: data.driver_id,
                                route_id: preferredRoute || null
                            })
                        });
                    }

                    showSuccess();
                    document.getElementById('driverRegistrationForm').reset();

                    // Redirect after 3 seconds
                    setTimeout(() => {
                        window.location.href = '/driver';
                    }, 3000);
                } else {
                    showError(data.error || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„');
                }
            } catch (error) {
                showError('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
            } finally {
                btnText.style.display = 'inline';
                btnLoading.style.display = 'none';
            }
        });

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = 'âŒ ' + message;
            errorDiv.style.display = 'block';
            document.getElementById('successMessage').style.display = 'none';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        function showSuccess() {
            const successDiv = document.getElementById('successMessage');
            successDiv.style.display = 'block';
            document.getElementById('errorMessage').style.display = 'none';
        }

        // Load routes on page load
        loadRoutes();
    </script>
    <!-- Theme & Language Manager -->
    <script src="/js/theme-manager.js"></script>
</body>

</html>